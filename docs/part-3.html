<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Mixed Models</title>
    <meta charset="utf-8" />
    <meta name="author" content="Michael Clark" />
    <meta name="date" content="2020-10-21" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/animate.css/animate.xaringan.css" rel="stylesheet" />
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/xaringanExtra-webcam/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <span class="title">Mixed Models</span>
## <span class="subtitle">Common Extensions</span>
### <span class="author">Michael Clark</span>
### <span class="institute">m-clark.github.io <br> <span class="citation">@statsdatasci</span> <br> CSCAR, UM</span>
### <span class="date">2020-10-21</span>

---

class: inverse

background-image: url(https://github.com/m-clark/m-clark.github.io/raw/master/img/Rlogo.svg)



<div>
<style type="text/css">.xaringan-extra-logo {
width: 5%;
height: 128px;
z-index: 0;
background-image: url(https://raw.githubusercontent.com/m-clark/m-clark.github.io/master/img/mc_logo.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
bottom:-3em;left:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide)')
        .forEach(function (slide) {
          const logo = document.createElement('a')
          logo.classList = 'xaringan-extra-logo'
          logo.href = 'https://m-clark.github.io'
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div><style>.shareagain-bar {
--shareagain-foreground: rgb(255, 255, 255);
--shareagain-background: rgba(0, 0, 0, 0.5);
--shareagain-facebook: none;
--shareagain-pinterest: none;
--shareagain-reddit: none;
}</style>





---
class: inverse middle center



### *Overview of Random Effects*

### *More Random Effects*

### **Common Extensions**

### *Issues*

### *Bayesian Approaches*


---
class: inverse middle center animated rollIn rollOut # https://animate.style/ 

# Additional Grouping Structure

---
class: inverse 

# Additional Grouping Structure: &lt;br&gt;Cross-classified Models

Often there is additional clustering/grouping.

Example:
- Items on a test
- Everyone sees all/multiple items
- Observations clustered within person and item

Terminology: *cross-classified models*

More generic: *non-nested*

---
class: middle img-slide

&lt;img src="img/crossed_effects.png" style="display:block; margin: 0 auto; width:125%"&gt;


---
class: inverse 

# Additional Grouping Structure: &lt;br&gt;Nested Models

Sometimes we have clusters nested within other clusters
  
- Which may be nested within still other clusters.
  
Example:
  
  - Repeated observations of people
  - Observations nested within person
  - People nested within geographic unit

---
class: middle img-slide

&lt;img src="img/multilevel1.png" style="display:block; margin: 0 auto; width:125%"&gt;



---
class: inverse 

# Additional Grouping Structure


Nested scenarios are a special case of general (non-nested) clustering


Whether factors are crossed or nested is property of the data...

*Not the model!*


---
class: inverse 

# Example: Crossed 

Student Achievement
&gt;Achievement scores for students. The sources of dependency are due to students having gone to the same primary or secondary schools. However, in this example, going to a primary school doesn’t necessarily mean you’ll go to a specific secondary school.

<div id="htmlwidget-30f303fe7c3cdb56cef8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-30f303fe7c3cdb56cef8">{"x":{"filter":"none","data":[[284,777,603,308,673,97,626,48,697,824,107,114,448,755,473,849,988,456,487,27,827,625,58,813,328,653,771,702,864,798,479,635,583,217,254,162,318,425,65,482,970,493,377,280,272,124,283,125,885,731,49,333,595,338,531,289,461,137,828,118,95,791,909,480,515,57,652,465,773,467,103,754,202,687,617,976,942,176,86,776,368,273,459,711,245,253,973,228,369,406,627,83,916,466,816,216,770,695,811,819,53,957,491,94,871,520,546,387,55,526,166,718,6,747,821,843,572,549,696,204,182,880,666,261,454,224,680,895,451,836,730,510,109,160,312,495,407,424,278,565,452,40,539,981,340,940,379,417,842,453,400,187,607,32,926,388,45,850,191,438,389,638,729,295,679,878,835,164,412,386,288,737,96,937,541,81,805,709,693,395,64,514,136,111,669,522,869,590,458,968,169,152,414,734,435,476,30,1000,993,804],[15,39,31,16,34,6,32,3,35,41,6,7,23,38,25,42,49,23,25,2,42,32,4,41,17,33,39,35,43,40,25,33,30,12,13,9,16,21,4,25,48,25,19,14,14,7,14,7,44,37,3,17,31,17,27,15,24,8,42,7,6,39,46,25,27,4,33,24,39,24,6,38,11,35,32,49,47,10,5,39,18,14,24,36,13,13,49,12,19,20,32,5,46,24,41,12,38,35,40,41,3,48,25,6,44,27,28,19,3,27,9,36,1,37,41,42,30,28,35,11,10,44,34,13,23,12,34,45,23,42,37,26,6,9,16,26,20,21,14,29,23,3,28,49,17,47,19,21,42,23,20,10,31,2,46,19,3,42,10,22,19,33,36,15,34,44,42,9,21,19,15,37,6,47,28,5,40,36,35,20,4,27,8,7,34,27,44,31,24,48,9,8,21,37,22,25,2,50,50,40],[8,18,15,23,26,7,28,14,5,25,15,2,21,16,27,26,9,3,26,6,30,16,9,22,4,16,11,6,17,5,21,26,5,11,22,19,6,21,7,19,10,14,3,19,16,23,8,1,21,25,9,25,22,14,6,6,6,12,24,3,6,20,16,28,21,15,21,26,9,3,6,15,12,26,4,28,7,19,19,10,27,2,3,13,28,8,15,6,25,10,10,8,18,7,27,17,28,5,22,7,19,29,19,22,9,14,21,23,8,28,8,8,4,25,6,29,22,16,24,19,2,30,11,12,16,10,21,20,18,29,29,6,17,7,13,25,2,11,25,13,19,14,6,28,1,29,7,23,27,3,26,1,16,14,29,19,11,9,23,2,14,8,18,2,18,27,22,17,21,13,21,7,11,15,18,5,28,10,26,7,4,5,23,7,14,7,15,21,10,30,6,10,18,18,30,7,6,28,30,24],[5.6,6.6,5.6,6.2,5.7,6,5.5,6.9,5.5,6.7,5.9,7.5,5.9,7.7,5.8,6.8,5.3,6,6.1,6.4,6.6,5.7,6,5.8,6.3,6.2,6.4,7.4,5.8,7.6,6.6,6.5,7.3,6.7,6.3,5.7,7.5,6.8,7.7,7.2,5.9,7.3,5.9,7.3,6.1,6.9,7.1,6.6,6.9,7,7.1,6.4,6.5,6.8,5.9,6.8,6.9,6,6.3,6.3,6,5.8,5.6,6.8,6.4,7.2,6.2,7.2,5.5,6.3,5.6,7.9,6.7,7.2,5.5,5.7,6.4,6.2,6.7,5.2,7.8,8.4,7,7.9,5.8,6.9,7.1,4.8,5.9,6.2,5.2,6.9,6,8.8,5.5,5.4,6.1,6.2,6.6,6.3,7.4,6.2,6.2,6.4,5.7,4.9,6.9,6.2,7.5,5.4,4.3,7.3,5,5.6,6.5,5.7,5.7,6.6,6.2,5.9,6.4,7.1,6.6,5.3,6.2,5.7,5.9,7.2,6.3,6.3,6.1,6.3,5.6,6.6,7.1,6.7,7.7,7.4,6.9,5.5,5.8,5.8,7.3,5.9,5,7.4,6.2,5.8,6.7,6.7,7,6.9,6.9,7.8,5.6,5.9,7.2,6.9,5.6,5.9,7.4,6.1,5.7,5.8,4.8,6.2,6.8,5.4,6.7,6.4,5.4,5.6,6.9,7.9,5.8,6.6,7.7,6.4,6.3,7,6.6,6.2,6.1,7.3,6.9,5,5.9,7,6.9,4.2,5.6,5.1,6,5.6,7.6,6.3,6.3,6,5.7,8.2],["male","female","male","female","female","male","male","female","male","male","female","female","male","female","male","female","female","male","male","female","male","female","female","male","male","male","male","female","male","female","male","female","female","female","male","male","female","male","female","male","female","male","male","female","female","female","male","female","male","female","female","female","male","female","male","male","male","male","female","female","female","male","male","female","female","female","male","male","female","male","female","female","male","male","male","male","male","female","male","female","female","female","male","male","male","female","male","female","female","male","female","female","female","female","male","male","male","male","female","male","female","male","male","female","male","male","male","female","female","male","male","male","female","female","female","male","female","female","male","female","female","female","male","male","male","male","male","male","male","male","male","male","female","female","male","male","female","female","female","male","female","male","female","male","male","female","male","male","male","male","male","female","male","female","male","female","female","female","female","female","female","male","male","male","male","male","female","male","female","male","male","male","male","female","male","male","male","male","female","male","male","female","female","male","male","female","male","female","female","female","female","male","male","male","female","male","female","male","female","male"],["5","lowest","2","5","4","4","lowest","5","3","5","2","5","3","5","5","5","3","3","2","5","5","highest","4","4","2","highest","5","highest","5","lowest","4","4","5","4","lowest","3","5","3","2","highest","5","5","3","5","2","highest","4","5","5","3","5","5","5","5","4","5","3","highest","2","5","3","highest","3","5","lowest","5","highest","5","5","lowest","3","5","4","4","2","5","3","2","highest","lowest","5","highest","5","3","4","5","2","5","5","5","2","lowest","2","highest","5","highest","2","4","3","5","2","3","highest","2","4","3","4","4","highest","4","4","5","4","highest","4","5","2","3","5","5","lowest","4","5","5","5","5","5","5","4","lowest","5","4","5","5","highest","highest","5","5","3","2","2","5","2","4","highest","3","3","3","5","5","5","4","5","5","5","3","5","3","3","lowest","highest","5","lowest","3","highest","highest","4","highest","4","5","3","3","highest","4","2","highest","5","4","3","highest","4","highest","5","3","5","3","lowest","4","3","4","2","2","3","5","3","highest","highest","5","3","highest"],["yes","no","yes","no","no","no","yes","no","no","yes","no","yes","no","yes","yes","yes","yes","no","yes","no","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","no","yes","no","no","no","no","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","no","yes","yes","yes","yes","yes","no","no","yes","yes","no","yes","no","yes","no","yes","no","yes","no","no","yes","yes","no","no","yes","no","yes","yes","yes","no","no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","no","yes","yes","no","no","yes","no","yes","no","yes","yes","no","no","no","no","no","yes","yes","yes","yes","yes","no","no","no","yes","no","no","no","no","no","no","no","yes","yes","yes","no","no","no","yes","yes","yes","yes","yes","no","no","yes","yes","yes","no","yes","yes","yes","no","yes","no","yes","no","yes","yes","no","yes","no","yes","yes","no","no","yes","no","yes","yes","no","yes","yes","yes","yes","no","no","yes","yes","yes","no","no","yes","yes","no","yes","yes","no","no","yes","yes","yes","no","no","yes","yes","yes","yes","yes","no","yes","yes","yes"],["no","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","no","yes","no","no","yes","no","yes","yes","yes","no","yes","yes","yes","no","no","yes","yes","yes","yes","yes","no","no","no","yes","yes","no","yes","yes","no","no","yes","yes","no","yes","yes","yes","yes","yes","no","yes","no","no","no","yes","yes","no","no","no","yes","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","yes","yes","yes","no","no","yes","no","no","no","yes","yes","no","yes","no","yes","yes","yes","no","no","yes","no","no","yes","yes","no","yes","no","yes","no","no","no","yes","yes","yes","no","yes","no","no","yes","yes","no","yes","no","yes","yes","no","no","yes","yes","yes","yes","yes","yes","no","no","yes","yes","no","no","yes","yes","yes","no","yes","yes","yes","no","yes","no","yes","yes","yes","yes","yes","no","no","yes","yes","yes","yes","yes","no","yes","no","yes","no","yes","no","no","no","no","no","no","no","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","no","no","yes","yes","no","yes","yes","yes"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>PUPIL<\/th>\n      <th>primary_school_id<\/th>\n      <th>secondary_school_id<\/th>\n      <th>achievement<\/th>\n      <th>sex<\/th>\n      <th>ses<\/th>\n      <th>primary_denominational<\/th>\n      <th>secondary_denominational<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tp","scrollX":true,"autoWidth":true,"columnDefs":[{"width":"100px","targets":1},{"width":"100px","targets":3},{"className":"dt-right","targets":[0,1,2,3]}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
class: inverse 

# Example: Crossed 


```r
pupils_crossed = lmer(
  achievement ~ sex + ses 
  + (1|primary_school_id) + (1|secondary_school_id),
  data = pupils
)
```

Examine the fixed effects: 


```r
extract_fixed_effects(pupils_crossed)
```

```
# A tibble: 7 x 7
  term       value    se     t p_value lower_2.5 upper_97.5
  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 Intercept  5.92  0.123 48.3    0         5.68       6.16 
2 sexfemale  0.261 0.046  5.72   0         0.171      0.35 
3 ses2       0.132 0.118  1.12   0.262    -0.098      0.362
4 ses3       0.098 0.11   0.89   0.373    -0.118      0.314
5 ses4       0.298 0.105  2.85   0.004     0.093      0.503
6 ses5       0.354 0.101  3.51   0         0.156      0.551
7 seshighest 0.616 0.11   5.60   0         0.401      0.832
```

---
class: inverse 

# Example: Crossed 

Examine the variance components:


```r
extract_vc(pupils_crossed, ci_level = FALSE)
```

```
                group    effect variance    sd var_prop
1   primary_school_id Intercept    0.173 0.416    0.243
2 secondary_school_id Intercept    0.066 0.257    0.093
3            Residual              0.473 0.688    0.664
```

What is our interpretation? &lt;span class="" style = "font-size: 200%"&gt;🤔&lt;/span&gt;


---
class: middle img-slide




&lt;img src="img/pupils_re.svg" style="display:block; margin: 0 auto; width:125%"&gt;


---
class: inverse 

# Example: Nested 

Nursing
&gt;For our demonstration we'll use the nurses data set. Here we are interested in the effect of a training program (`treatment`) on stress levels (on a scale of 1-7) of nurses.  In this scenario, nurses are nested within wards, which themselves are nested within hospitals, so we will have random effects pertaining to ward (within hospital) and hospital.

<div id="htmlwidget-beb5e1dc871a0f8ab42f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-beb5e1dc871a0f8ab42f">{"x":{"filter":"none","data":[[12,9,8,14,1,22,2,20,16,8,12,19,2,14,14,24,16,12,21,19,2,13,20,23,22,13,11,20,21,19,10,22,13,6,17,21,7,11,14,5,13,25,13,6,18,19,24,16,21,18,23,7,5,21,24,8,2,24,9,13,21,12,21,16,8,14,20,24,15,14,14,2,12,22,23,14,11,13,21,19,15,4,10,20,16,11,2,15,5,20,18,3,17,20,15,19,3,8,4,13,14,25,4,15,7,19,5,7,3,9,18,11,10,8,18,9,7,7,21,4,4,21,24,8,14,11,15,21,17,22,8,17,7,7,25,18,4,19,20,3,23,10,7,4,2,15,3,4,6,3,13,1,9,1,12,13,19,19,25,6,3,13,10,11,7,9,15,13,12,18,13,10,13,11,3,24,7,9,11,16,9,3,14,9,10,9,14,15,3,13,18,16,18,23,11,15,12,14,22,24],[1,2,1,4,4,3,4,2,2,4,4,4,2,3,2,3,2,3,2,2,2,2,4,2,1,1,1,4,2,2,3,4,4,1,3,3,2,2,4,3,1,2,1,2,3,3,4,3,1,1,2,1,2,2,2,1,1,3,3,2,2,1,4,3,4,1,4,1,1,3,1,2,1,2,4,3,3,1,1,2,3,3,1,1,1,4,1,3,4,3,2,3,4,4,2,4,1,4,2,1,4,2,3,2,1,3,1,2,1,3,3,1,4,2,2,3,2,1,1,3,4,3,4,4,1,3,1,3,4,4,4,2,4,4,1,2,2,1,3,2,4,3,4,1,3,1,4,1,1,3,4,4,4,3,1,3,3,3,3,3,1,3,2,4,3,4,2,1,4,1,3,4,4,4,1,2,4,3,3,3,3,2,2,1,2,1,2,2,1,2,1,4,2,1,2,2,4,2,4,1],[121,92,81,144,14,223,24,202,162,84,124,194,22,143,142,243,162,123,212,192,22,132,204,232,221,131,111,204,212,192,103,224,134,61,173,213,72,112,144,53,131,252,131,62,183,193,244,163,211,181,232,71,52,212,242,81,21,243,93,132,212,121,214,163,84,141,204,241,151,143,141,22,121,222,234,143,113,131,211,192,153,43,101,201,161,114,21,153,54,203,182,33,174,204,152,194,31,84,42,131,144,252,43,152,71,193,51,72,31,93,183,111,104,82,182,93,72,71,211,43,44,213,244,84,141,113,151,213,174,224,84,172,74,74,251,182,42,191,203,32,234,103,74,41,23,151,34,41,61,33,134,14,94,13,121,133,193,193,253,63,31,133,102,114,73,94,152,131,124,181,133,104,134,114,31,242,74,93,113,163,93,32,142,91,102,91,142,152,31,132,181,164,182,231,112,152,124,142,224,241],[434,313,269,566,32,882,66,791,639,297,462,776,54,563,541,947,642,455,836,754,48,499,813,902,860,478,384,815,834,753,368,888,519,184,683,840,236,401,568,168,485,975,479,193,718,760,961,652,818,699,908,220,165,827,946,268,42,951,322,487,833,430,853,648,290,532,808,937,577,561,526,51,432,874,922,562,402,484,819,752,605,135,349,780,629,422,43,604,178,802,711,95,697,814,593,767,76,294,129,474,572,974,134,596,224,759,152,232,73,320,720,381,377,279,713,324,233,227,821,132,145,843,959,298,537,405,579,837,694,891,292,677,256,252,970,716,126,741,803,83,923,362,258,116,59,588,104,115,189,99,521,33,337,27,428,505,757,765,987,204,80,502,357,412,242,331,594,483,472,704,501,378,515,414,78,941,253,329,403,647,326,82,544,309,355,307,550,598,77,489,706,659,714,895,400,590,473,549,887,933],[42,39,62,43,46,34,41,61,31,47,31,46,33,55,45,47,50,32,33,57,43,47,45,25,29,48,39,51,31,45,39,48,48,56,43,38,46,39,47,58,27,32,33,28,23,46,48,23,48,61,29,60,39,61,55,41,57,32,31,62,55,25,37,64,56,64,52,33,61,51,36,60,39,25,37,38,61,46,32,57,50,25,47,46,64,60,51,28,47,36,32,25,56,53,55,32,60,55,36,57,45,36,29,25,27,46,55,56,55,29,55,23,29,43,47,58,43,38,34,42,64,42,37,41,25,31,51,38,32,42,45,42,36,29,38,47,41,29,58,24,48,53,58,31,33,47,53,56,64,33,43,58,34,43,38,34,45,39,28,28,60,53,58,34,43,64,53,31,52,57,27,51,55,42,31,31,29,57,37,43,46,24,45,50,58,46,51,45,24,31,51,51,62,24,29,27,42,61,34,28],["Female","Male","Female","Female","Female","Male","Female","Female","Female","Female","Female","Male","Female","Male","Female","Male","Female","Female","Male","Female","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Male","Female","Male","Female","Male","Female","Male","Male","Male","Female","Female","Female","Male","Female","Female","Male","Female","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Male","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Male","Female","Female","Female","Female","Male","Female","Female","Female","Female","Female","Male","Female","Female","Male","Male","Female","Male","Male","Female","Female","Female","Male","Male","Female","Female","Female","Female","Male","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female","Male","Female","Female","Female","Female","Female","Female","Male","Female","Female","Male","Female","Male","Female","Male","Male","Female","Female","Female","Male","Female","Female","Male","Female","Male","Female","Female","Female","Male","Female","Male","Male","Female","Male","Female","Female","Male","Female","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Male","Male","Female","Female"],[17,14,17,13,20,15,17,20,10,18,7,17,14,22,20,15,17,14,4,22,15,14,15,7,15,24,18,21,17,15,11,22,11,24,15,18,15,8,17,20,4,15,20,8,7,18,18,3,18,29,18,27,14,18,24,15,29,17,13,24,22,10,17,27,20,25,24,20,28,20,10,18,20,13,13,18,20,13,8,21,17,10,20,24,28,22,20,6,20,15,15,7,24,17,25,11,31,25,20,22,20,11,13,15,13,13,24,27,25,15,24,6,13,14,21,24,21,21,15,13,25,20,15,17,6,13,24,18,14,18,15,15,18,13,18,20,13,13,22,10,20,24,17,17,11,18,21,20,28,20,24,22,17,20,17,11,15,14,8,8,27,24,20,13,20,25,20,13,27,28,10,20,17,20,18,11,10,22,13,18,20,13,18,17,20,14,15,22,7,15,20,22,20,8,6,17,22,22,14,10],[4,3,6,5,5,5,4,5,5,5,6,6,5,5,3,6,5,5,4,5,4,4,7,6,6,4,4,6,3,5,6,5,6,4,4,4,5,4,5,6,5,5,3,4,6,6,6,7,3,3,6,4,6,3,6,5,5,6,5,3,3,4,5,5,5,4,6,3,5,5,3,5,4,5,5,5,5,4,3,6,6,6,5,4,4,6,5,5,6,7,4,5,4,6,5,6,4,5,3,4,5,5,5,6,4,6,6,5,4,4,5,4,6,5,4,5,5,5,3,6,5,4,5,5,4,5,3,5,5,6,6,5,5,4,6,4,5,6,6,4,5,6,5,5,5,4,6,5,4,5,5,4,4,4,3,5,7,6,6,5,5,6,5,5,5,5,6,4,6,3,6,5,5,5,5,5,5,5,5,6,4,3,4,3,6,3,5,5,4,3,4,6,4,6,4,5,6,4,5,4],["general care","special care","general care","special care","special care","general care","special care","special care","special care","special care","special care","special care","special care","general care","special care","general care","special care","general care","special care","special care","special care","special care","special care","special care","general care","general care","general care","special care","special care","special care","general care","special care","special care","general care","general care","general care","special care","special care","special care","general care","general care","special care","general care","special care","general care","general care","special care","general care","general care","general care","special care","general care","special care","special care","special care","general care","general care","general care","general care","special care","special care","general care","special care","general care","special care","general care","special care","general care","general care","general care","general care","special care","general care","special care","special care","general care","general care","general care","general care","special care","general care","general care","general care","general care","general care","special care","general care","general care","special care","general care","special care","general care","special care","special care","special care","special care","general care","special care","special care","general care","special care","special care","general care","special care","general care","general care","general care","special care","general care","general care","general care","general care","special care","special care","special care","general care","special care","general care","general care","general care","special care","general care","special care","special care","general care","general care","general care","general care","special care","special care","special care","special care","special care","special care","general care","special care","special care","general care","general care","special care","special care","general care","special care","general care","general care","general care","special care","general care","general care","general care","special care","special care","special care","general care","general care","general care","general care","general care","general care","general care","general care","general care","special care","special care","general care","special care","special care","general care","special care","general care","general care","special care","special care","special care","general care","special care","special care","general care","general care","general care","general care","special care","special care","general care","special care","general care","special care","special care","general care","special care","general care","special care","special care","general care","special care","special care","special care","special care","special care","general care"],["medium","small","medium","small","large","medium","medium","small","small","medium","medium","large","medium","small","small","small","small","medium","small","large","medium","small","small","large","medium","small","medium","small","small","large","medium","medium","small","medium","medium","small","medium","medium","small","medium","small","medium","small","medium","small","large","small","small","small","small","large","medium","medium","small","small","medium","medium","small","small","small","small","medium","small","small","medium","small","small","small","medium","small","small","medium","medium","medium","large","small","medium","small","small","large","medium","large","medium","small","small","medium","medium","medium","medium","small","small","small","medium","small","medium","large","small","medium","large","small","small","medium","large","medium","medium","large","medium","medium","small","small","small","medium","medium","medium","small","small","medium","medium","small","large","large","small","small","medium","small","medium","medium","small","medium","medium","medium","medium","medium","medium","medium","small","large","large","small","small","large","medium","medium","large","medium","medium","small","large","medium","small","small","large","small","large","medium","small","large","large","medium","medium","small","small","medium","medium","medium","small","medium","small","medium","small","small","medium","small","medium","small","small","medium","small","medium","small","small","small","small","small","medium","small","small","medium","small","small","small","small","small","large","medium","medium","medium","small","medium","small"],["Training","Training","Training","Ctrl","Ctrl","Ctrl","Ctrl","Training","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Ctrl","Training","Ctrl","Training","Training","Training","Training","Ctrl","Training","Training","Training","Training","Ctrl","Training","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Ctrl","Training","Training","Ctrl","Ctrl","Training","Training","Training","Training","Ctrl","Ctrl","Ctrl","Ctrl","Training","Training","Training","Training","Training","Training","Training","Training","Training","Ctrl","Ctrl","Training","Training","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Training","Ctrl","Training","Training","Training","Training","Ctrl","Ctrl","Ctrl","Training","Training","Training","Ctrl","Ctrl","Training","Training","Training","Ctrl","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Ctrl","Training","Training","Ctrl","Training","Ctrl","Training","Training","Ctrl","Training","Training","Training","Ctrl","Ctrl","Training","Ctrl","Training","Training","Ctrl","Training","Training","Training","Ctrl","Ctrl","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Ctrl","Ctrl","Ctrl","Ctrl","Training","Ctrl","Ctrl","Training","Training","Training","Training","Ctrl","Training","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Ctrl","Training","Training","Ctrl","Ctrl","Ctrl","Ctrl","Ctrl","Training","Ctrl","Ctrl","Ctrl","Ctrl","Ctrl","Training","Ctrl","Training","Ctrl","Ctrl","Ctrl","Training","Training","Ctrl","Training","Ctrl","Ctrl","Ctrl","Ctrl","Training","Training","Ctrl","Ctrl","Ctrl","Ctrl","Ctrl","Training","Training","Training","Training","Training","Training","Training","Training","Training","Training","Ctrl","Training","Training","Training","Training","Ctrl","Training","Ctrl","Training"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>ward<\/th>\n      <th>wardid<\/th>\n      <th>nurse<\/th>\n      <th>age<\/th>\n      <th>sex<\/th>\n      <th>experience<\/th>\n      <th>stress<\/th>\n      <th>wardtype<\/th>\n      <th>hospsize<\/th>\n      <th>treatment<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tp","scrollX":true,"autoWidth":true,"columnDefs":[{"width":"100px","targets":1},{"width":"100px","targets":3},{"className":"dt-right","targets":[0,1,2,3,4,6,7]}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
class: inverse 

# Example: Nested 

Different ways to do this.


```r
nurses_hierarchical = lmer(
  stress ~ age + sex + experience + treatment + wardtype + hospsize
  + (1 | hospital) + (1 | hospital:ward),
  data = nurses
)
```



```r
nurses_hierarchical = lmer(
  stress ~ age  + sex + experience + treatment + wardtype + hospsize
  + (1|hospital/ward),
  data = nurses
)
```



```r
summary(nurses_hierarchical, correlation = F)
```

---
class: inverse 

Examine the fixed effects: 


```r
# lme4::fixef(nurses_hierarchical)
extract_fixed_effects(nurses_hierarchical)
```

```
# A tibble: 8 x 7
  term                  value    se       t p_value lower_2.5 upper_97.5
  &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 Intercept             5.38  0.185  29.1     0         5.02       5.74 
2 age                   0.022 0.002  10.1     0         0.018      0.026
3 sexFemale            -0.453 0.035 -13.0     0        -0.522     -0.385
4 experience           -0.062 0.004 -13.8     0        -0.07      -0.053
5 treatmentTraining    -0.7   0.12   -5.84    0        -0.935     -0.465
6 wardtypespecial care  0.051 0.12    0.424   0.671    -0.184      0.286
7 hospsizemedium        0.489 0.202   2.43    0.015     0.094      0.884
8 hospsizelarge         0.902 0.275   3.28    0.001     0.363      1.44 
```

---
class: inverse 

# Example: Nested 

Examine the variance components:


```r
extract_vc(nurses_hierarchical, ci_level = FALSE)
```

```
          group    effect variance    sd var_prop
1 hospital:ward Intercept    0.337 0.580    0.500
2      hospital Intercept    0.119 0.345    0.177
3      Residual              0.217 0.466    0.323
```

What is our interpretation? &lt;span class="" style = "font-size: 200%"&gt;🤔&lt;/span&gt;


---
class: middle img-slide




&lt;img src="img/nurse_re.svg" style="display:block; margin: 0 auto; width:125%"&gt;

---
class: inverse 

# Example: Nested 

What if we'd treated it as crossed?


```r
nurses_hierarchical = lmer(
  stress ~ age + sex + experience + treatment + wardtype + hospsize
  + (1 | hospital) + (1 | ward),
  data = nurses
)

extract_vc(nurses_hierarchical, ci_level=0)
```

```
     group    effect variance    sd var_prop
1 hospital Intercept    0.196 0.442    0.297
2     ward Intercept    0.000 0.000    0.000
3 Residual              0.463 0.681    0.703
```

---
class: inverse 

# Example: Nested 

But...


```r
nurses_hierarchical = lmer(
  stress ~ age + sex + experience + treatment + wardtype + hospsize
  + (1 | hospital) + (1 | wardid),
  data = nurses
)

extract_vc(nurses_hierarchical, ci_level=0)
```

```
     group    effect variance    sd var_prop
1   wardid Intercept    0.337 0.580    0.500
2 hospital Intercept    0.119 0.345    0.177
3 Residual              0.217 0.466    0.323
```

---
class: inverse 

# Example: Nested 

What was the difference?

--

`wardid` properly contains unique values for each ward

`ward` is just numbered `1:*` for each hospital

--

So if your labels are correct...

... you can always just used 'crossed' style. 😃


---
class: inverse middle center animated rollIn rollOut # https://animate.style/ 

# Residual Structure

---
class: img-slide slide-font-75 slide-title-90

# Residual Structure


Correlation matrix of observations




- &lt;span style = "font-size: 75%"&gt;3 students from GPA data&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;ICC: 0.064 / (0.064  + 0.058) = 0.523&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;Total variance = 0.064  + 0.058 =  0.122&lt;/span&gt;



&lt;img src="part-3_files/figure-html/unnamed-chunk-15-1.svg" width="66%" style="display: block; margin: auto;" /&gt;

---
class: img-slide-less-pad

# Residual Structure

Mixed model default: constant covariance/correlation

`$$\Sigma = 
\left[
\begin{array}{ccc} 
\color{orange}{\sigma^2 + \tau^2} &amp; \tau^2   &amp; \tau^2  &amp; \tau^2 &amp; \tau^2 &amp; \tau^2   \\
\tau^2   &amp; \color{orange}{\sigma^2 + \tau^2} &amp; \tau^2 &amp; \tau^2 &amp; \tau^2 &amp; \tau^2    \\
\tau^2   &amp; \tau^2   &amp; \color{orange}{\sigma^2 + \tau^2} &amp; \tau^2 &amp; \tau^2 &amp; \tau^2  \\
\tau^2   &amp; \tau^2   &amp; \tau^2 &amp; \color{orange}{\sigma^2 + \tau^2} &amp; \tau^2 &amp; \tau^2\\
\tau^2   &amp; \tau^2   &amp; \tau^2  &amp; \tau^2 &amp; \color{orange}{\sigma^2 + \tau^2}  &amp; \tau^2 \\
\tau^2   &amp; \tau^2   &amp; \tau^2  &amp; \tau^2   &amp; \tau^2  &amp; \color{orange}{\sigma^2 + \tau^2} \\
\end{array}\right]$$`



---
class: img-slide-less-pad

# Residual Structure

Consider the following model
- single group with just three observations

`$$\boldsymbol{y} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})$$`

---
class: img-slide-less-pad

# Residual Structure

Standard linear regression:

`$$\Sigma = 
\left[
\begin{array}{ccc} 
\sigma^2 &amp; 0   &amp; 0   \\
0   &amp; \sigma^2 &amp; 0   \\
0   &amp; 0   &amp; \sigma^2 \\
\end{array}\right]$$`

Heterogeneous variances:

`$$\Sigma = 
\left[
\begin{array}{ccc} 
\sigma_1^2 &amp; 0   &amp; 0   \\
0   &amp; \sigma_2^2 &amp; 0   \\
0   &amp; 0   &amp; \sigma_3^2 \\
\end{array}\right]$$`


---
class: img-slide-less-pad

# Residual Structure

Covariance structure (constant variance):

`$$\Sigma_\sigma = 
\left[
\begin{array}{ccc} 
\sigma^2 &amp;\sigma_{12}   &amp; \sigma_{13}   \\
\sigma_{21}    &amp; \sigma^2 &amp;  \sigma_{23}    \\
\sigma_{31}   &amp; \sigma_{32}   &amp; \sigma^2 \\
\end{array}\right]$$`

As Correlation structure:

`$$\Sigma_\rho = \sigma^2
\left[
\begin{array}{ccc} 
1 &amp; \rho_{12}   &amp; \rho_{13}   \\
\rho_{21}   &amp; 1 &amp; \rho_{23}   \\
\rho_{31}   &amp; \rho_{32}   &amp; 1 \\
\end{array}\right]$$`

---
class: inverse

# Residual Structure

Take home message:

- Can go from full independence to any correlation structure imaginable
- Residual variance can even have its own model!

---
class: inverse

# Heterogeneous variance


```r
library(glmmTMB)

heterovar_res2 = glmmTMB(
  gpa ~ occasion + (1|student) + diag(0 + occas |student), 
  data = gpa
)
```

---
class: code-only slide-title-90

# Heterogeneous variance


```r
summary(heterovar_res2)
```

```
 Family: gaussian  ( identity )
Formula:          gpa ~ occasion + (1 | student) + diag(0 + occas | student)
Data: gpa

     AIC      BIC   logLik deviance df.resid 
   261.1    312.0   -120.5    241.1     1190 

Random effects:

Conditional model:
 Groups    Name                   Variance Std.Dev. Corr                     
 student   (Intercept)            0.093123 0.30516                           
 student.1 occasyear 1 semester 1 0.129833 0.36032                           
           occasyear 1 semester 2 0.086087 0.29341  0.00                     
           occasyear 2 semester 1 0.046240 0.21503  0.00 0.00                
           occasyear 2 semester 2 0.017615 0.13272  0.00 0.00 0.00           
           occasyear 3 semester 1 0.008709 0.09332  0.00 0.00 0.00 0.00      
           occasyear 3 semester 2 0.017730 0.13316  0.00 0.00 0.00 0.00 0.00 
 Residual                         0.008065 0.08980                           
Number of obs: 1200, groups:  student, 200

Dispersion estimate for gaussian family (sigma^2): 0.00806 

Conditional model:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 2.598788   0.026201   99.19   &lt;2e-16 ***
occasion    0.106141   0.004034   26.31   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


---
class: inverse

# Heterogeneous variance

glmmTMB treats this as an additional random effect:

`$$y = X\beta + \mathrm{re}_{student} + \mathrm{re}_{hetvar} + \epsilon$$`

For example, within a person, this new random effect would be something like:


```r
covmat = diag(est_variances)
MASS::mvrnorm(1, mu = rep(0, 6), Sigma = covmat)
```

```
[1] -0.21026884 -0.02875994 -0.25541768 -0.18164960  0.17007838 -0.10886285
```

---
class: inverse

# Autocorrelation

When observations are measured over time, we can estimate something like the following, or anything that might be appropriate.

- Auto-regressive with lag 1 (AR1)
- Correlation decreases with spread in time

&lt;span class="" style = "font-size:75%"&gt;
`$$\Sigma = \sigma^2
\left[
\begin{array}{cccc} 
1 &amp; \rho     &amp; \rho^2   &amp; \rho^3   \\
\rho     &amp; 1 &amp; \rho     &amp; \rho^2   \\
\rho^2   &amp; \rho     &amp; 1 &amp; \rho     \\
\rho^3   &amp; \rho^2   &amp; \rho     &amp; 1 \\
\end{array}\right]$$`
&lt;/span&gt;

---
class: inverse

# Autocorrelation

If `\(\rho\)` was estimated to be .5:

&lt;span class="" style = "font-size:100%"&gt;
`$$\Sigma = \sigma^2
\left[
\begin{array}{cccc} 
1 &amp; .5       &amp; .25      &amp; .06   \\
.5       &amp; 1 &amp; .5       &amp; .25  \\
.25      &amp; .5       &amp; 1 &amp; .5    \\
.06      &amp; .25      &amp;  .5      &amp; 1 \\
\end{array}\right]$$`
&lt;/span&gt;

---
class: inverse

# Autocorrelation

glmmTMB again estimates this as a separate random effect
- `occas` is the factor form of occasion
- also provides AR standard deviation/variance
- Not all output will be depicted the same way across packages


```r
corr_res_tmb = glmmTMB(
  gpa ~ occasion +  ar1(0 + occas | student) + (1 | student),
  data = gpa
)
```

---
class: inverse

# Autocorrelation


```r
summary(corr_res_tmb)
```

```
 Family: gaussian  ( identity )
Formula:          gpa ~ occasion + ar1(0 + occas | student) + (1 | student)
Data: gpa

     AIC      BIC   logLik deviance df.resid 
   290.5    321.0   -139.2    278.5     1194 

Random effects:

Conditional model:
 Groups    Name                   Variance  Std.Dev.  Corr      
 student   occasyear 1 semester 1 9.283e-02 3.047e-01 0.84 (ar1)
 student.1 (Intercept)            2.442e-10 1.563e-05           
 Residual                         2.791e-02 1.671e-01           
Number of obs: 1200, groups:  student, 200

Dispersion estimate for gaussian family (sigma^2): 0.0279 

Conditional model:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 2.597577   0.023385  111.08   &lt;2e-16 ***
occasion    0.106875   0.005493   19.46   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


---
class: inverse middle center animated fadeIn fadeOut # https://animate.style/ 

# Generalized Linear Models

---
class: inverse 

# Generalized Linear Models

We can generalize (linear) mixed models

Data: speed dating

&gt;In the speed dating events, the experiment randomly assigned each participant to ten short dates (four minutes) with other participants. For each date, each person rated six attributes (attractive, sincere, intelligent, fun, ambitious, shared interests) of the other person on a 10-point scale and wrote down whether he or she would like to see the other person again. Our target variable is whether the participant would be willing to date the person again (decision). 

---
class: inverse 

# Generalized Linear Models

For &lt;span class="pack" style = ""&gt;lme4&lt;/span&gt;, we just switch from &lt;span class="func" style = ""&gt;lmer&lt;/span&gt; to &lt;span class="func" style = ""&gt;glmer&lt;/span&gt;


```r
## load('data/speed_dating.RData')

sd_model = glmer(
  decision ~ sex + samerace + attractive_sc + sincere_sc + intelligent_sc
  + (1 | iid),
  data   = speed_dating,
  family = binomial
)

# summary(sd_model, correlation = FALSE)
```

---
class: inverse slide-font-75 slide-title-90

# Generalized Linear Models

No residual variance estimate for binomial
- No straightforward ICC


```r
summarize_model(sd_model, ci = F)
```

```

Variance Components:
```

```
 Group    Effect Variance   SD Var_prop
   iid Intercept     2.71 1.65     1.00
```

```

Fixed Effects:
```

```
           Term Value   SE     Z P_value Lower_2.5 Upper_97.5
      Intercept -0.74 0.12 -6.13    0.00     -0.98      -0.51
        sexMale  0.16 0.16  0.95    0.34     -0.17       0.48
    sameraceYes  0.31 0.07  4.19    0.00      0.17       0.46
  attractive_sc  0.50 0.01 33.56    0.00      0.47       0.53
     sincere_sc  0.09 0.02  5.75    0.00      0.06       0.12
 intelligent_sc  0.14 0.02  8.23    0.00      0.11       0.18
```

---
class: inverse slide-font-75 slide-title-90

# Generalized Linear Models

Interpretation of fixed effects similar to GLM

However, these are not population averages

Conditional on the random effects:
- Not exactly the same as they are in LM
- Slightly larger vs. GEE or basic logistic

---
class: inverse 

# Exercises


##### Sociometric data

In the following data, kids are put into different groups and rate each other in terms of how much they would like to share some activity with the others. We have identifying variables for the person doing the rating (sender), the person being rated (receiver), what group they are in, as well as age and sex for both sender and receiver, as well as group size.

---
class: inverse 

# Exercises

To run a mixed model, we will have three sources of structure to consider:

- senders (within group)
- receivers (within group)
- group

First, load the sociometric data. 


```r
load('data/sociometric.RData')
```

---
class: inverse slide-title-90 slide-font-75 slide-less-pad 

# Exercises


To run the model, we will proceed with the following modeling steps. For each, make sure you are creating a separate model object for each model run.

- &lt;span style = "font-size: 75%"&gt;*Model 1*: No covariates, only sender and receiver random effects. Note that even though we don't add group yet, still use the nesting approach to specify the effects (e.g. `1|group:receiver`)&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;*Model 2*: No covariates, add group random effect&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;*Model 3*: Add all covariates: `agesend/rec`, `sexsend/rec`, and `grsize` (group size)&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;*Model 4*: In order to examine sex matching effects, add an interaction of the sex variables to the model `sexsend:sexrec`.&lt;/span&gt;
- &lt;span style = "font-size: 75%"&gt;Compare models with AIC.&lt;/span&gt;




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "zenburn",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
